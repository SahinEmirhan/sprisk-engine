<?xml version="1.0" encoding="UTF-8"?>
<testsuite name="io.github.sahinemirhan.RedisRiskStorageIntegrationTest" tests="1" skipped="0" failures="0" errors="0" timestamp="2025-10-30T01:43:12" hostname="LENOVO" time="1.388">
  <properties/>
  <testcase name="redisStorageIsUsedWhenConfigured()" classname="io.github.sahinemirhan.RedisRiskStorageIntegrationTest" time="1.388"/>
  <system-out><![CDATA[04:43:06.431 [Test worker] INFO tc.redis:7.2.5-alpine -- Creating container for image: redis:7.2.5-alpine
04:43:06.591 [Test worker] INFO tc.redis:7.2.5-alpine -- Container redis:7.2.5-alpine is starting: 5581629b6d32702afcbe4e8f9fcf7f5179f6ac10df1918774a176746e3c9b696
04:43:07.262 [Test worker] INFO tc.redis:7.2.5-alpine -- Container redis:7.2.5-alpine started in PT0.8301928S
04:43:07.427 [Test worker] INFO org.springframework.test.context.support.AnnotationConfigContextLoaderUtils -- Could not detect default configuration classes for test class [io.github.sahinemirhan.RedisRiskStorageIntegrationTest]: RedisRiskStorageIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
04:43:07.610 [Test worker] INFO org.springframework.boot.test.context.SpringBootTestContextBootstrapper -- Found @SpringBootConfiguration io.github.sahinemirhan.SpriskEngineExampleApplication for test class io.github.sahinemirhan.RedisRiskStorageIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/

 :: Spring Boot ::                (v3.5.7)

2025-10-30T04:43:08.319+03:00  INFO 33764 --- [    Test worker] i.g.s.RedisRiskStorageIntegrationTest    : Starting RedisRiskStorageIntegrationTest using Java 21.0.5 with PID 33764 (started by cress in C:\Users\cress\Workspace\spring_projects\sprisk-engine\sprisk-engine-example-app)
2025-10-30T04:43:08.319+03:00  INFO 33764 --- [    Test worker] i.g.s.RedisRiskStorageIntegrationTest    : No active profile set, falling back to 1 default profile: "default"
2025-10-30T04:43:09.297+03:00  INFO 33764 --- [    Test worker] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-30T04:43:09.297+03:00  INFO 33764 --- [    Test worker] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-30T04:43:09.367+03:00  INFO 33764 --- [    Test worker] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 36 ms. Found 0 Redis repository interfaces.
[Sprisk] RedisStorage activated (Redis connection successful)
[Sprisk] Window strategy = SLIDING
[Sprisk] BruteForceRule registered
[Sprisk] CredentialStuffingRule registered
[Sprisk] Rule loaded: NIGHT_TIME
[Sprisk] Rule loaded: IP_VELOCITY
[Sprisk] Rule loaded: USER_VELOCITY
[Sprisk] Rule loaded: BRUTE_FORCE
[Sprisk] Rule loaded: CREDENTIAL_STUFFING
[Sprisk] Total rules loaded = 5
[Sprisk] RiskAspect initialized
2025-10-30T04:43:12.622+03:00  INFO 33764 --- [    Test worker] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2025-10-30T04:43:12.622+03:00  INFO 33764 --- [    Test worker] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2025-10-30T04:43:12.638+03:00  INFO 33764 --- [    Test worker] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2025-10-30T04:43:12.701+03:00  INFO 33764 --- [    Test worker] i.g.s.RedisRiskStorageIntegrationTest    : Started RedisRiskStorageIntegrationTest in 4.883 seconds (process running for 10.603)
[DEBUG] USER_VELOCITY.evaluate - action= userId=redis-user
[DEBUG] USER_VELOCITY key=sprisk:velocity:user:redis-user count=1
Decision score = 20
2025-10-30T04:43:14.082+03:00  INFO 33764 --- [    Test worker] i.g.s.config.RiskDebugLoggingFilter      : spriskRuleFlagsString={night-time=true, ip-velocity=false, user-velocity=false, brute-force=false, credential-stuffing=false} path=/hello status=200
2025-10-30T04:43:14.272+03:00  INFO 33764 --- [xecutorLoop-1-1] i.l.core.protocol.ConnectionWatchdog     : Reconnecting, last destination was localhost/127.0.0.1:56519
2025-10-30T04:43:14.289+03:00  WARN 33764 --- [ioEventLoop-4-2] i.l.core.protocol.ConnectionWatchdog     : Cannot reconnect to [localhost/<unresolved>:56519]: Connection closed prematurely

io.lettuce.core.RedisConnectionException: Connection closed prematurely
	at io.lettuce.core.protocol.RedisHandshakeHandler.channelInactive(RedisHandshakeHandler.java:76) ~[lettuce-core-6.6.0.RELEASE.jar:6.6.0.RELEASE/643bd47]
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:303) ~[netty-transport-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281) ~[netty-transport-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:274) ~[netty-transport-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.channel.ChannelInboundHandlerAdapter.channelInactive(ChannelInboundHandlerAdapter.java:81) ~[netty-transport-4.1.128.Final.jar:4.1.128.Final]
	at io.lettuce.core.ChannelGroupListener.channelInactive(ChannelGroupListener.java:54) ~[lettuce-core-6.6.0.RELEASE.jar:6.6.0.RELEASE/643bd47]
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:303) ~[netty-transport-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281) ~[netty-transport-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:274) ~[netty-transport-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.channel.DefaultChannelPipeline$HeadContext.channelInactive(DefaultChannelPipeline.java:1352) ~[netty-transport-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:301) ~[netty-transport-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:281) ~[netty-transport-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.channel.DefaultChannelPipeline.fireChannelInactive(DefaultChannelPipeline.java:850) ~[netty-transport-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.channel.AbstractChannel$AbstractUnsafe$7.run(AbstractChannel.java:811) ~[netty-transport-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:173) ~[netty-common-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:166) ~[netty-common-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:472) ~[netty-common-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:566) ~[netty-transport-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:998) ~[netty-common-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[netty-common-4.1.128.Final.jar:4.1.128.Final]
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[netty-common-4.1.128.Final.jar:4.1.128.Final]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

]]></system-out>
  <system-err><![CDATA[Mockito is currently self-attaching to enable the inline-mock-maker. This will no longer work in future releases of the JDK. Please add Mockito as an agent to your build as described in Mockito's documentation: https://javadoc.io/doc/org.mockito/mockito-core/latest/org.mockito/org/mockito/Mockito.html#0.3
WARNING: A Java agent has been loaded dynamically (C:\Users\cress\.gradle\caches\modules-2\files-2.1\net.bytebuddy\byte-buddy-agent\1.17.8\f09415827a71be7ed621c7bd02550678f28bc81c\byte-buddy-agent-1.17.8.jar)
WARNING: If a serviceability tool is in use, please run with -XX:+EnableDynamicAgentLoading to hide this warning
WARNING: If a serviceability tool is not in use, please run with -Djdk.instrument.traceUsage for more information
WARNING: Dynamic loading of agents will be disallowed by default in a future release
]]></system-err>
</testsuite>
